---
title: "Publications"
format:
  html:
    theme: 
      - custom.scss
---

<!--

Because the rendered site is frozen, an update to the source code (i.e. this document) is required to update the page.  After adding a publication to Zotero and syncing, edit this comment (add a space or something), `quarto_render()`, then push to GitHub to update the website.
-->

```{r}
#| echo: false
#| output: asis
library(httr2)
library(stringr)
req <-
  request("https://api.zotero.org") |>
  req_url_query(
    v = 3,
    include = "bib",
    sort = "date",
    # style = "journal-of-ecology",
    style = "apa",
    itemType = "-attachment || note"
  ) |>
  req_headers(`Zotero-API-Key` = Sys.getenv("ZOTERO_API_KEY")) |>
  req_url_path("users", Sys.getenv("ZOTERO_USER_ID"), "publications", "items") |> 
  req_retry()

resp <- 
  req |> 
  req_perform()
# pattern to match URLs
url_pattern <- "(https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=\\[\\];]*))"

resp |> 
  resp_body_json() |>  
  purrr::map("bib") |> 
  unlist() |> 
  # surround URLs with <> so they are actually links in markdown
  str_replace(url_pattern, "<\\1>") |> 
  # Bold my name 
  str_replace("(Masiello, D\\. J\\.)", '<b>\\1</b>') |> 
  str_replace("(David J\\. Masiello)", '<b>\\1</b>') |> 
  str_replace("(Masiello, David John)", '<b>\\1</b>') |> 
  cat()
```

::: {#refs}
:::